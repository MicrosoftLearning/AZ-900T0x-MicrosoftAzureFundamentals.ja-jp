---
wts:
  title: 17 - Azure Policy の作成 (10 分)
  module: 'Module 05: Describe identity, governance, privacy, and compliance features'
ms.openlocfilehash: 2811044ec560b0ac42f49a578666ed1694feb32a
ms.sourcegitcommit: 26c283fffdd08057fdce65fa29de218fff21c7d0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/27/2022
ms.locfileid: "137908423"
---
# <a name="17---create-an-azure-policy-10-min"></a>17 - Azure Policy の作成 (10 分)

このチュートリアルでは、Azure リソースのデプロイを特定の場所に制限する Azure Policy を作成します。

# <a name="task-1-create-a-policy-assignment"></a>タスク 1:ポリシー割り当てを作成する 

このタスクでは、許可された場所のポリシーを構成し、サブスクリプションに割り当てます。 

1. [Azure portal](https://portal.azure.com) にサインインします。

2. **[すべてのサービス]** ブレードで、「**ポリシー**」を検索して選択し、**[作成]** セクションで **[定義]** をクリックします。  組み込みのポリシー定義の一覧を確認します。 たとえば、**[カテゴリ]** ドロップダウンでは、**[計算]** のみを選択します。 **[許可されている仮想マシン サイズ SKU]** の定義を使用すると、自分の組織がデプロイできる仮想マシン SKU のセットを指定できます。

3. **[ポリシー]** ページに戻り、**[作成]** セクションの **[割り当て]** をクリックします。 割り当ては、特定のスコープ内で実行するように割り当てられたポリシーです。 たとえば、サブスクリプションのスコープに定義を割り当てることができます。 

4. **[ポリシー - 割り当て]** ページの上部にある **[ポリシーの割り当て]** をクリックします。

5. **[ポリシーの割り当て]** ページで、既定のスコープを維持します。

      | 設定 | 値 | 
    | --- | --- |
    | スコープ| **選択された既定値を使用する**|
    | ポリシー定義 | 省略記号をクリックし、「**許可されている場所**」を検索して、**[選択]** をクリックする |
    | 割り当て名 | **許可されている場所** |
    
    ![フィールド値が入力され、[選択] ボタンが強調表示されている [スコープ] ペインのスクリーンショット。 ](../images/1402.png)
6. **[パラメーター]** タブで **[西日本]** を選択します。 **[確認と作成]** をクリックし、**[作成]** をクリックします。

    **注**:スコープによって、ポリシーの割り当てが適用されるリソース、またはリソースのグループが決まります。 このポリシーを特定のリソース グループに割り当てることができますが、ポリシーをサブスクリプション レベルで割り当てることもできます。 スコープの構成によって、リソースが除外される場合があることにご注意ください。 除外はオプションです。

    **注**: この **[許可されている場所]** ポリシー定義では、すべてのリソースがデプロイされる必要がある場所を指定します。 別の場所が選択されている場合、デプロイは許可されません。 詳細については、[Azure Policy Samples](https://docs.microsoft.com/en-us/azure/governance/policy/samples/index) ページをご覧ください。

   ![さまざまなフィールドが強調表示され、[マネージド ディスクを使用していない VM の監査] オプションが選択されている [使用可能な定義] ペインのスクリーンショット。](../images/1403.png)

9. これで、**[許可されている場所]** ポリシーの割り当てが **[ポリシー - 割り当て]** ペインに一覧表示され、配置されました。指定したスコープ レベル (サブスクリプション レベル) でポリシーが適用されます。

# <a name="task-2-test-allowed-location-policy"></a>タスク 2:許可された場所のポリシーをテストする

このタスクでは、許可された場所のポリシーをテストします。 

1. Azure Portal の **[すべてのサービス]** ブレードで、 **[ストレージ アカウント]** を検索して選択し、 **[+ 作成]** をクリックします。

2. ストレージ アカウントを構成します (ストレージ アカウント名の **xxxx** は、名前がグローバルに一意になる文字と数字に置き換えます)。 その他は既定値のままにします。 

    | 設定 | 値 | 
    | --- | --- |
    | サブスクリプション | **提供された既定値を使用する** |
    | Resource group | **myRGPolicy** (新規作成) |
    | ストレージ アカウント名 | **storageaccountxxxx** |
    | 場所 | **(米国) 米国東部** |

3. **[Review + create]\(レビュー + 作成\)** をクリックし、 **[作成]** をクリックします。 

4. **[許可されている場所]** ポリシー名を含め、リソースがポリシーによって許可されなかったことを示す **[デプロイの失敗]** エラーが表示されます。

# <a name="task-3-delete-the-policy-assignment"></a>タスク 3:ポリシーの割り当てを削除する

このタスクでは、許可された場所のポリシーの割り当てを削除してテストします。 

ポリシーの割り当てを削除して、今後の作業がブロックされないようにします。

1. **[すべてのサービス]** ブレードで、「**ポリシー**」を検索して選択し、**[許可されている場所]** ポリシーをクリックします。

    **注**: **[ポリシー]** ブレードで、割り当てたさまざまなポリシーのコンプライアンス状態を表示することができます。

    **注**: [許可されている場所] ポリシーに、正しくないリソースが表示される場合があります。 それらはポリシーを割り当てる前に作成されたリソースです。
 
2. **[許可されている場所]** をクリックします。[[許可されている場所] ポリシー コンプライアンス] ウィンドウが開きます。

3. 上部のメニューから **[割り当ての削除]** をクリックします。 **[はい]** をクリックして、ポリシー割り当ての削除を確定します

   ![[割り当ての削除] メニュー項目のスクリーンショット。](../images/1407.png)

4. 別のストレージ アカウントを作成して、ポリシーが無効になっていることを確認してください。

    **注**: **[許可されている場所]** ポリシーが役立つ一般的なシナリオには、次のようなものがあります。 
    - *コスト トラッキング*:リージョンの場所ごとに、サブスクリプションが異なる場合があります。 このポリシーにより、すべてのリソースが対象のリージョンにデプロイされるようにし、コスト トラッキングを行うことができます。 
    - *データ常駐とセキュリティ コンプライアンス*:データ常駐要件を設定し、顧客ごとまたは特定のワークロードごとにサブスクリプションを作成し、すべてのリソースを特定のデータセンターにデプロイしてデータとセキュリティのコンプライアンス要件を確保することを定義することもできます。

おめでとうございます! Azure リソースの展開を特定のデータセンターに制限する Azure Policy を作成しました。

**注**:追加コストを回避するには、オプションでこのリソース グループを削除します。 リソース グループを検索し、リソース グループをクリックして、**[リソース グループの削除]** をクリックします。 リソース グループの名前を確認し、**[削除]** をクリックします。 **通知** を監視して、削除の進行状況を確認します。
